#ifndef MM4X4_H_
#define MM4X4_H_

#include <stdlib.h>
#include <string.h>

template <typename T>
void mm4x4(
    const T *A,
    const T *B,
          T *C
){
    for (int i = 0; i < 4; i++){
        for (int j = 0; j < 4; j++){
            for (int k = 0; k < 4; k++){
                C[i*4+j] += A[i*4+k] * B[k*4+j];
            }
        }
    }
}

template <typename T>
void mm4x4s(
    const T *A0,
    const T *A1,
    const T *A2,
    const T *A3,
    const T *B0,
    const T *B1,
    const T *B2,
    const T *B3,
          T *C0,
          T *C1,
          T *C2,
          T *C3
){
    C0[0] += A0[0]*B0[0] + A0[1]*B1[0] + A0[2]*B2[0] + A0[3]*B3[0];
    C0[1] += A0[0]*B0[1] + A0[1]*B1[1] + A0[2]*B2[1] + A0[3]*B3[1];
    C0[2] += A0[0]*B0[2] + A0[1]*B1[2] + A0[2]*B2[2] + A0[3]*B3[2];
    C0[3] += A0[0]*B0[3] + A0[1]*B1[3] + A0[2]*B2[3] + A0[3]*B3[3];

    C1[0] += A1[0]*B0[0] + A1[1]*B1[0] + A1[2]*B2[0] + A1[3]*B3[0];
    C1[1] += A1[0]*B0[1] + A1[1]*B1[1] + A1[2]*B2[1] + A1[3]*B3[1];
    C1[2] += A1[0]*B0[2] + A1[1]*B1[2] + A1[2]*B2[2] + A1[3]*B3[2];
    C1[3] += A1[0]*B0[3] + A1[1]*B1[3] + A1[2]*B2[3] + A1[3]*B3[3];

    C2[0] += A2[0]*B0[0] + A2[1]*B1[0] + A2[2]*B2[0] + A2[3]*B3[0];
    C2[1] += A2[0]*B0[1] + A2[1]*B1[1] + A2[2]*B2[1] + A2[3]*B3[1];
    C2[2] += A2[0]*B0[2] + A2[1]*B1[2] + A2[2]*B2[2] + A2[3]*B3[2];
    C2[3] += A2[0]*B0[3] + A2[1]*B1[3] + A2[2]*B2[3] + A2[3]*B3[3];

    C3[0] += A3[0]*B0[0] + A3[1]*B1[0] + A3[2]*B2[0] + A3[3]*B3[0];
    C3[1] += A3[0]*B0[1] + A3[1]*B1[1] + A3[2]*B2[1] + A3[3]*B3[1];
    C3[2] += A3[0]*B0[2] + A3[1]*B1[2] + A3[2]*B2[2] + A3[3]*B3[2];
    C3[3] += A3[0]*B0[3] + A3[1]*B1[3] + A3[2]*B2[3] + A3[3]*B3[3];
}
#endif